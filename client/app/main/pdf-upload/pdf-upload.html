<section class="pdf">
  <heading title="'Parse and Upload Absence Records'"></heading>
  <div class="upload-inputs">
    <div class="form-horizontal">
      <div ng-class="selected.school ? 'has-success' : 'has-error'">
        <label class="control-label col-lg-1">School</label>
        <ui-select class="col-lg-3"
          theme="bootstrap"
          ng-model="selected.school"
          ng-disabled="defaultSchool || result.data"
          required>
          <ui-select-match class="ui-select-match" placeholder="Select a school">{{$select.selected.name}}
          </ui-select-match>
          <ui-select-choices class="ui-select-choices" repeat="school in schools | filter: $select.search">
            <div ng-bind-html="school.name | highlight: $select.search"></div>
          </ui-select-choices>
        </ui-select>
      </div>
      <div ng-class="parsedRecord ? 'has-success' : 'has-error'">
        <label class="control-label col-lg-1" for="pdfInput">PDF</label>
        <div class="col-lg-3">
          <input id="pdfInput"
            class="form-control"
            type="file"
            ng-model="file"
            ngf-pattern="'application/pdf'"
            ngf-select
            ng-disabled="result.data"
            required>
        </div>
      </div>
      <div ng-class="date ? 'has-success' : 'has-error'">
        <label class="control-label col-lg-1" for="date">Date</label>
        <div class="col-lg-3">
          <div class="input-group ">
            <input id="date"
              type="text"
              class="form-control"
              ng-model="date"
              is-open="open"
              datepicker-options="datepickerOptions"
              uib-datepicker-popup="shortDate"
              ng-required="true"
              readonly/>
            <span class="input-group-btn">
              <button type="button" class="btn btn-success" ng-click="open = !open" ng-disabled="result.data">
                <i class="fa fa-calendar"></i>
              </button>
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="upload-buttons col-xs-12" ng-if="!result.data">
    <button class="btn btn-primary"
      type="button"
      ng-click="uploadPDF()"
      ng-disabled="!date || !parsedRecord || !selected.school || pending">
      Submit
    </button>
  </div>

  <div class="confirm-buttons col-xs-12" ng-if="result.data">
    <button class="btn btn-success" ng-click="confirmUpload()" ng-disabled="pending">Confirm</button>
    <button class="btn btn-danger" ng-click="cancelUpload()" ng-disabled="pending">Cancel</button>
  </div>

  <div class="parsing-progress col-xs-12" ng-if="file && !result.data">
    <uib-progressbar value="progress" type="default"></uib-progressbar>
  </div>
</section>
<section class="confirm" ng-if="result.data">
  <heading title="selected.school.name"></heading>
  <div class="confirm-table">
    <div class="table-responsive">
      <table class="table table-condensed">
        <thead class="cf">
        <tr>
          <th>Name</th>
          <th>Student Id</th>
          <th>Absences</th>
          <th>Δ Absences</th>
          <th>Tardies</th>
          <th>Δ Tardies</th>
          <th>Present</th>
          <th>Enrolled</th>
          <th>Interventions</th>
        </tr>
        </thead>
        <tr class="info" ng-if="result.data.creates">
          <th>New Students</th>
        </tr>
        <tr class="info" ng-if="result.data.creates" ng-repeat="listing in result.data.creates">
          <td data-title="Name">{{listing.student.lastName}}, {{listing.student.firstName}}</td>
          <td data-title="Student Id">{{listing.student.studentId}}</td>
          <td data-title="Absences">{{listing.entry.absences}}</td>
          <td data-title="Δ Absences">{{listing.entry.absencesDelta}}</td>
          <td data-title="Tardies">{{listing.entry.tardies}}</td>
          <td data-title="Δ Tardies">{{listing.entry.tardiesDelta}}</td>
          <td data-title="Present">{{listing.entry.present}}</td>
          <td data-title="Enrolled">{{listing.entry.enrolled}}</td>
          <td data-title="Interventions">{{listing.entry.interventions.length}}</td>
        </tr>
        <tr class="success" ng-if="result.data.updates">
          <th>Existing Students</th>
        </tr>
        <tr class="success" ng-if="result.data.updates" ng-repeat="listing in result.data.updates">
          <td data-title="Name">{{listing.student.lastName}}, {{listing.student.firstName}}</td>
          <td data-title="Student Id">{{listing.student.studentId}}</td>
          <td data-title="Absences">{{listing.entry.absences}}</td>
          <td data-title="Δ Absences">{{listing.entry.absencesDelta}}</td>
          <td data-title="Tardies">{{listing.entry.tardies}}</td>
          <td data-title="Δ Tardies">{{listing.entry.tardiesDelta}}</td>
          <td data-title="Present">{{listing.entry.present}}</td>
          <td data-title="Enrolled">{{listing.entry.enrolled}}</td>
          <td data-title="Interventions">{{listing.entry.interventions.length}}</td>
        </tr>
      </table>
    </div>
  </div>
</section>
